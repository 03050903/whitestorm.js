"undefined"==typeof Array.isArray&&(Array.isArray=function(e){"use strict";return"[object Array]"===Object.prototype.toString.call(e)});var WHS={REVISION:1};WHS.headers={},WHS.API={},WHS.ADD={},WHS.objects=[],WHS.grounds=[];var api=WHS.API;WHS.API.merge=function(e,t){"use strict";if(arguments.length<2)console.error("No rabbits for the box. (arguments)",[e,t]);else if(arguments.length=2)if(Array.isArray(t)&&t.length<=1)e.add(t[0]);else if(Array.isArray(t)&&t.length>=2)for(var s=0;s<t.length;s++)e.add(t[s]);else!Array.isArray(t)&&e?e.add(t):console.error("box is undefined. Line "+(new Error).lineNumber+". Func merge.",[e,t])},WHS.API.def=function(e,t,s){"use strict";if(arguments.length<2)console.error("Something wrong! option? value?");else{if(2==arguments.length)return e=e||t;if(3==arguments.length&&s)return s=e||t}},WHS.API.ConvexFigure=function(e){"use strict";if(arguments.length<1)console.error("No THREE.js geometry");else if(arguments.length=1){var t=new Array,s=new Array;return e.vertices.forEach(function(e){t.push(new WHS.headers.cannonjs.Vec3(e.x,e.y,e.z))}),e.faces.forEach(function(e){s.push([e.a,e.b,e.c])}),new WHS.headers.cannonjs.ConvexPolyhedron(t,s)}},WHS.API.TrimeshFigure=function(e,t){"use strict";if(arguments.length<1)console.error("No THREE.js geometry");else if(arguments.length=1){var s=[],i=[],a=[];e.vertices.forEach(function(e){s.push(e.x),s.push(e.y),s.push(e.z),t&&a.push({x:e.x,y:e.y,z:e.z})}),e.faces.forEach(function(e){i.push(e.a),i.push(e.b),i.push(e.c)});var r=new WHS.headers.cannonjs.Trimesh(s,i);return r.updateNormals(),r.heightsValues=a,r}},WHS.API.Triangulate=function(e,t){"use strict";if(arguments.length<1)console.error("No THREE.js geometry");else if(arguments.length=1){var s=new WHS.headers.threejs.Geometry,i=[];e.faces.forEach(function(a){var r=new WHS.headers.threejs.Geometry;[].push.apply(r.vertices,[e.vertices[a.a],e.vertices[a.b],e.vertices[a.c]]),r.faceVertexUvs[0].push([new WHS.headers.threejs.Vector2(0,0),new WHS.headers.threejs.Vector2(0,1),new WHS.headers.threejs.Vector2(1,1),new WHS.headers.threejs.Vector2(1,0)]),r.faces.push(new WHS.headers.threejs.Face3(0,1,2)),r.computeFaceNormals();var o=new WHS.headers.threejs.Mesh(r,t);o.updateMatrix(),s.merge(o.geometry,o.matrix),i.push(t)});var a=new WHS.headers.threejs.Mesh(s,new WHS.headers.threejs.MeshFaceMaterial(i));return a}},WHS.API.rotateBody=function(e,t){"use strict";return e.quaternion.x=Math.sin(Math.PI/180*t.x*.5),e.quaternion.y=Math.sin(Math.PI/180*t.y*.5),e.quaternion.z=Math.sin(Math.PI/180*t.z*.5),e.quaternion.w=Math.cos(45),e},WHS.API.texture=function(e,t){var s=WHS.headers.threejs.ImageUtils.loadTexture(e);if(t){var i=t;i.offset=i.offset||{x:1,y:1},i.offset.x=i.offset.x||1,i.offset.y=i.offset.y||1,i.repeat=i.repeat||{x:1,y:1},i.repeat.x=i.repeat.x||1,i.repeat.y=i.repeat.y||1,s.wrapS=s.wrapT=WHS.headers.threejs.RepeatWrapping,s.repeat.set(i.repeat.x,i.repeat.y)}return s},WHS.ADD.shape=function(){return new WHS.headers.threejs.Shape},WHS.API.getheight=function(e,t,s){"use strict";console.log(s);var t=t||1e3;return this.raycaster=new WHS.headers.threejs.Raycaster(new WHS.headers.threejs.Vector3(e.x,-t,e.y).normalize(),new WHS.headers.threejs.Vector3(e.x,t,e.y).normalize()),this.intersect=this.raycaster.intersectObject(s),console.log(this),this.intersect},WHS.init=function(e,t,s){"use strict";console.log("WHS.init",WHS.REVISION),s=s||{},this.anaglyph=s.anaglyph,api.def(s.gravity,{x:0,y:-982,z:0}),this.threejs=e,this.cannonjs=t,WHS.headers.threejs=this.threejs,WHS.headers.cannonjs=this.cannonjs,this.params=s,this.scene=new this.threejs.Scene,this.world=new this.cannonjs.World,this.world.gravity.set(s.gravity.x,s.gravity.y,s.gravity.z),this.world.broadphase=new this.cannonjs.NaiveBroadphase,this.world.quatNormalizeSkip=0,this.world.quatNormalizeFast=!1,this.solver=new this.cannonjs.GSSolver,this.world.defaultContactMaterial.contactEquationStiffness=1e8,this.world.defaultContactMaterial.contactEquationRegularizationTime=3,this.solver.iterations=20,this.solver.tolerance=0;var i=!0;this.world.solver=i?new this.cannonjs.SplitSolver(this.solver):this.solver,this.physicsMaterial=new this.cannonjs.Material("slipperyMaterial"),this.physicsContactMaterial=new this.cannonjs.ContactMaterial(this.physicsMaterial,this.physicsMaterial,0,.3),this.world.addContactMaterial(this.physicsContactMaterial),s.helper&&(this.cannonDebugRenderer=new this.threejs.CannonDebugRenderer(this.scene,this.world)),s.stats&&(this.stats=new Stats,"fps"==s.stats?this.stats.setMode(0):"ms"==s.stats?this.stats.setMode(1):"mb"==s.stats?this.stats.setMode(1):(this.stats.setMode(0),console.warn([this.stats],"Please, apply right stats mode [fps, ms, mb] .")),this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="0px",this.stats.domElement.style.bottom="0px",document.body.appendChild(this.stats.domElement)),this.params.camera||(this.params.camera={}),this.params.camera.aspect=api.def(this.params.camera.aspect,75),this.params.camera.near=api.def(this.params.camera.near,1),this.params.camera.far=api.def(this.params.camera.far,1e3),console.log(this.params),this.camera=new this.threejs.PerspectiveCamera(this.params.camera.aspect,window.innerWidth/window.innerHeight,this.params.camera.near,this.params.camera.far),this.params.camera.x=api.def(this.params.camera.x,0),this.params.camera.y=api.def(this.params.camera.y,0),this.params.camera.z=api.def(this.params.camera.z,0),this.camera.position.set(this.params.camera.x,this.params.camera.y,this.params.camera.z),api.merge(this.scene,this.camera),this.renderer=new this.threejs.WebGLRenderer,this.renderer.setClearColor(7396351),this.renderer.shadowMapEnabled=!0,this.renderer.shadowMapSoft=!0,this.anaglyph?(this.effect=new this.threejs.AnaglyphEffect(this.renderer),this.effect.setSize(window.innerWidth,window.innerHeight),this.effect.render(this.scene,this.camera)):(this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.render(this.scene,this.camera)),$(this.renderer.domElement).css({width:"100%",height:"100%"}),$(this.renderer.domElement).attr(""),$("body").append(this.renderer.domElement),$("body").css({margin:0,padding:0,position:"relative",overflow:"hidden"}),WHS.init.prototype.animate(null,this),s.wagner&&(this.composer=new s.wagner.Composer(this.renderer),this.composer.setSize(window.innerWidth,window.innerHeight),this.renderer.autoClearColor=!0,this.composer.reset(),this.composer.render(this.scene,this.camera)),this.composer.eff=[];var a=this;return s.autoresize&&$(window).on("load resize",function(){a.camera.aspect=window.innerWidth/window.innerHeight,a.camera.updateProjectionMatrix(),a.renderer.setSize(window.innerWidth,window.innerHeight),s.wagner&&a.composer.setSize(window.innerWidth,window.innerHeight)}),a},WHS.init.prototype.addObject=function(e,t){"use strict";var s={};s.root=this;var i=t;switch(s.whsobject=!0,s.releaseTime=(new Date).getTime(),i.color=t.color||16777215,i.mass=t.mass||0,i.pos="object"==typeof t.pos?t.pos:{x:0,y:0,z:0},i.rot="object"==typeof t.pos?t.pos:{x:0,y:0,z:0},i.material=t.materialOptions||{},i.geometry=t.geometryOptions||{},i.material.type){case"basic":s.materialType=new this.threejs.MeshBasicMaterial(i.material);break;case"linebasic":s.materialType=new this.threejs.LineBasicMaterial(i.material);break;case"linedashed":s.materialType=new this.threejs.LineDashedMaterial(i.material);break;case"material":s.materialType=new this.threejs.Material(i.material);break;case"depth":s.materialType=new this.threejs.MeshDepthMaterial(i.material);break;case"face":s.materialType=new this.threejs.MeshFaceMaterial(i.material.materials);break;case"lambert":this.materialType=new this.threejs.MeshLambertMaterial(i.material);break;case"normal":s.materialType=new this.threejs.MeshNormalMaterial(i.material);break;case"phong":s.materialType=new this.threejs.MeshPhongMaterial(i.material);break;case"pointcloud":s.materialType=new this.threejs.PointCloudMaterial(i.material);break;case"rawshader":s.materialType=new this.threejs.RawShaderMaterial(i.material);break;case"shader":s.materialType=new this.threejs.ShaderMaterial(i.material);break;case"spritecanvas":s.materialType=new this.threejs.SpriteCanvasMaterial(i.material);break;case"sprite":s.materialType=new this.threejs.SpriteMaterial(i.material)}switch(e){case"sphere":var a=0;api.def(i.geometry.segmentA,32),api.def(i.geometry.segmentB,32),WHS.objects.forEach(function(e){"sphere"==e.type&&a++}),s.type="sphere",s.name=i.name||"sphere"+a,s.visible=new this.threejs.Mesh(new this.threejs.SphereGeometry(i.geometry.radius,i.geometry.segmentA,i.geometry.segmentB),s.materialType),s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),t.onlyvis?s.onlyvis=!0:(s.physic=new this.cannonjs.Sphere(i.geometry.radius),s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"cube":var a=0;api.def(i.geometry.width,1),api.def(i.geometry.height,1),api.def(i.geometry.depth,1),WHS.objects.forEach(function(e){"cube"==e.type&&a++}),s.type="cube",s.name=i.name||"cube"+a,s.visible=new this.threejs.Mesh(new this.threejs.BoxGeometry(i.geometry.width,i.geometry.height,i.geometry.depth),s.materialType),s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),t.onlyvis?s.onlyvis=!0:(s.physic=new this.cannonjs.Box(new this.cannonjs.Vec3(.5*i.geometry.width,.5*i.geometry.height,.5*i.geometry.depth)),s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.quaternion.setFromAxisAngle(new CANNON.Vec3(1,0,0),Math.PI/180*i.rot.x),s.body.quaternion.setFromAxisAngle(new CANNON.Vec3(0,1,0),Math.PI/180*i.rot.y),s.body.quaternion.setFromAxisAngle(new CANNON.Vec3(0,0,1),Math.PI/180*i.rot.z),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"cylinder":var a=0;api.def(i.geometry.radiusTop,1),api.def(i.geometry.radiusBottom,1),api.def(i.geometry.height,1),api.def(i.geometry.radiusSegments,32),WHS.objects.forEach(function(e){"cylinder"==e.type&&a++}),s.type="cylinder",s.name=i.name||"cylinder"+a,s.visible=new this.threejs.Mesh(new this.threejs.CylinderGeometry(i.geometry.radiusTop,i.geometry.radiusBottom,i.geometry.height,i.geometry.radiusSegments),s.materialType),s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),t.onlyvis?s.onlyvis=!0:(s.physic=new this.cannonjs.Cylinder(i.geometry.radiusTop,i.geometry.radiusBottom,i.geometry.height,i.geometry.radiusSegments),s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"dodecahedron":var a=0;api.def(i.geometry.radius,1),api.def(i.geometry.detail,0),WHS.objects.forEach(function(e){"dodecahedron"==e.type&&a++}),s.type="dodecahedron",s.name=i.name||"dodecahedron"+a,s.visible=new this.threejs.Mesh(new this.threejs.DodecahedronGeometry(i.geometry.radius,i.geometry.detail),s.materialType),s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),t.onlyvis?s.onlyvis=!0:(s.physic=new WHS.API.ConvexFigure(s.visible.geometry),s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"extrude":var a=0;api.def(i.geometry.shapes,[]),api.def(i.geometry.options,{}),WHS.objects.forEach(function(e){"extrude"==e.type&&a++}),s.type="extrude",s.name=i.name||"extrude"+a,s.visible=new this.threejs.Mesh(new this.threejs.ExtrudeGeometry(i.geometry.shapes,i.geometry.options),s.materialType),s.visible.name=this.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),console.log(s.visible.geometry),t.onlyvis?s.onlyvis=!0:(s.physic=new WHS.API.ConvexFigure(s.visible.geometry),s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"icosahedron":var a=0;api.def(i.geometry.radius,1),api.def(i.geometry.detail,0),WHS.objects.forEach(function(e){"icosahedron"==e.type&&a++}),s.type="icosahedron",s.name=i.name||"icosahedron"+a,s.visible=new this.threejs.Mesh(new this.threejs.IcosahedronGeometry(i.geometry.radius,i.geometry.detail),s.materialType),s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),t.onlyvis?s.onlyvis=!0:(s.physic=new WHS.API.ConvexFigure(this.visible.geometry),s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"lathe":var a=0;api.def(i.geometry.points,[]),WHS.objects.forEach(function(e){"lathe"==e.type&&a++}),s.type="lathe",s.name=i.name||"lathe"+a,s.visible=new this.threejs.Mesh(new this.threejs.LatheGeometry(i.geometry.points),s.materialType),s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),t.onlyvis?s.onlyvis=!0:(s.physic=new WHS.API.ConvexFigure(this.visible.geometry),this.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"octahedron":var a=0;api.def(i.geometry.radius,1),api.def(i.geometry.detail,0),WHS.objects.forEach(function(e){"octahedron"==e.type&&a++}),s.type="octahedron",s.name=i.name||"octahedron"+a,s.visible=new this.threejs.Mesh(new this.threejs.OctahedronGeometry(i.geometry.radius,i.geometry.detail),s.materialType),s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),t.onlyvis?s.onlyvis=!0:(s.physic=new WHS.API.ConvexFigure(this.visible.geometry),s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"parametric":var a=0;api.def(i.geometry.func,function(){}),api.def(i.geometry.slices,10),api.def(i.geometry.stacks,10),WHS.objects.forEach(function(e){"parametric"===e.type&&a++}),s.type="parametric",s.name=i.name||"parametric"+a,s.visible=new this.threejs.Mesh(new this.threejs.ParametricGeometry(i.geometry.func,i.geometry.slices,i.geometry.stacks),s.materialType),s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),t.onlyvis?s.onlyvis=!0:(s.physic=new WHS.API.ConvexFigure(s.visible.geometry),s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=this.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"plane":var a=0;api.def(i.geometry.func,function(){}),api.def(i.geometry.width,10),api.def(i.geometry.height,10),api.def(i.geometry.segments,32),WHS.objects.forEach(function(e){"plane"==e.type&&a++}),s.type="plane",s.name=i.name||"plane"+a,s.visible=new this.threejs.Mesh(new this.threejs.PlaneBufferGeometry(i.geometry.width,i.geometry.height,i.geometry.segments),s.materialType),s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),t.onlyvis?s.onlyvis=!0:(s.physic=new WHS.API.ConvexFigure(s.visible.geometry),s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"polyhedron":var a=0;api.def(i.geometry.verticesOfCube,[]),api.def(i.geometry.indicesOfFaces,[]),api.def(i.geometry.radius,1),api.def(i.geometry.detail,1),WHS.objects.forEach(function(e){"polyhedron"==e.type&&a++}),s.type="polyhedron",s.name=i.name||"polyhedron"+a,s.visible=new this.threejs.Mesh(new this.threejs.PolyhedronGeometry(i.geometry.verticesOfCube,i.geometry.indicesOfFaces),s.materialType),s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),t.onlyvis?s.onlyvis=!0:(s.physic=new WHS.API.ConvexFigure(s.visible.geometry),s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"ring":var a=0;api.def(i.geometry.innerRadius,0),api.def(i.geometry.outerRadius,50),api.def(i.geometry.thetaSegments,1),api.def(i.geometry.phiSegments,8),api.def(i.geometry.thetaStart,0),api.def(i.geometry.thetaLength,2*Math.PI),WHS.objects.forEach(function(e){"ring"==e.type&&a++}),s.type="ring",s.name=i.name||"ring"+a,s.visible=new this.threejs.Mesh(new this.threejs.TorusGeometry(i.geometry.outerRadius,(i.geometry.outerRadius-i.geometry.innerRadius)/2,i.geometry.thetaSegments,i.geometry.phiSegments),s.materialType),s.visible.scale.z=1/(i.geometry.outerRadius-i.geometry.innerRadius)*2,s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),t.onlyvis?s.onlyvis=!0:(s.physic=this.cannonjs.Trimesh.createTorus(i.geometry.outerRadius,(i.geometry.outerRadius-i.geometry.innerRadius)/2,i.geometry.thetaSegments,i.geometry.phiSegments),s.physic.scale.z=1/(i.geometry.outerRadius-i.geometry.innerRadius)*2,s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"shape":var a=0;WHS.objects.forEach(function(e){"shape"==e.type&&a++}),s.type="shape",s.name=i.name||"shape"+a,s.visible=new this.threejs.Mesh(new this.threejs.ShapeGeometry(i.geometry.shapes),s.materialType),s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),s.onlyvis=!0,console.warn("This is not physic object. 2D!",[s]),WHS.objects.push(s);break;case"tetrahedron":var a=0;api.def(i.geometry.radius,1),api.def(i.geometry.detail,0),WHS.objects.forEach(function(e){"tetrahedron"==e.type&&a++}),s.type="tetrahedron",s.name=i.name||"tetrahedron"+a,s.visible=new this.threejs.Mesh(new this.threejs.TetrahedronGeometry(i.geometry.radius,i.geometry.detail),s.materialType),s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),t.onlyvis?s.onlyvis=!0:(s.physic=new WHS.API.ConvexFigure(this.visible.geometry),s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"text":var a=0;i.geometry.parameters=i.geometry.parameters||{},api.def(i.geometry.text,"Hello World!"),api.def(i.geometry.parameters.size,1),api.def(i.geometry.parameters.height,50),api.def(i.geometry.parameters.curveSegments,1),api.def(i.geometry.parameters.font,"Adelle"),api.def(i.geometry.parameters.weight,"normal"),api.def(i.geometry.parameters.style,"normal"),api.def(i.geometry.parameters.bevelEnabled,!1),api.def(i.geometry.parameters.bevelThickness,10),api.def(i.geometry.parameters.bevelSize,8),WHS.objects.forEach(function(e){"text"==e.type&&a++}),s.type="text",s.name=i.name||"text"+a,s.visible=new this.threejs.Mesh(new this.threejs.TextGeometry(i.geometry.text,i.geometry.parameters),s.materialType),s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),t.onlyvis?s.onlyvis=!0:(s.physic=new WHS.API.TrimeshFigure(s.visible.geometry),s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"torus":var a=0;api.def(i.geometry.radius,100),api.def(i.geometry.tube,40),api.def(i.geometry.radialSegments,8),api.def(i.geometry.tubularSegments,6),api.def(i.geometry.arc,2*Math.PI),WHS.objects.forEach(function(e){"torus"==e.type&&a++}),s.type="torus",s.name=i.name||"torus"+a,s.visible=new this.threejs.Mesh(new this.threejs.TorusGeometry(i.geometry.radius,i.geometry.tube,i.geometry.radialSegments,i.geometry.tubularSegments,i.geometry.arc),s.materialType),s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),t.onlyvis?s.onlyvis=!0:(s.physic=this.cannonjs.Trimesh.createTorus(i.geometry.radius,i.geometry.tube,i.geometry.radialSegments,i.geometry.tubularSegments),s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"torusknot":var a=0;api.def(i.geometry.radius,100),api.def(i.geometry.tube,40),api.def(i.geometry.radialSegments,8),api.def(i.geometry.tubularSegments,6),api.def(i.geometry.arc,2*Math.PI),WHS.objects.forEach(function(e){"torusknot"==e.type&&a++}),s.type="torusknot",s.name=i.name||"torusknot"+a,s.visible=new this.threejs.Mesh(new this.threejs.TorusKnotGeometry(i.geometry.radius,i.geometry.tube,i.geometry.radialSegments,i.geometry.tubularSegments,i.geometry.p,i.geometry.q,i.geometry.heightScale),s.materialType),s.visible.name=s.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,s.visible),t.onlyvis?s.onlyvis=!0:(s.physic=new WHS.API.TrimeshFigure(s.visible.geometry),s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s);break;case"tube":var a=0;s.CustomSinCurve=this.threejs.Curve.create(function(e){this.scale=e||1},function(e){var t=3*e-1.5,s=Math.sin(2*Math.PI*e),i=0;return new this.threejs.Vector3(t,s,i).multiplyScalar(this.scale)}),i.geometry.path||(i.geometry.path=new this.CustomSinCurve(100)),api.def(i.geometry.segments,20),api.def(i.geometry.radius,2),api.def(i.geometry.radiusSegments,8),api.def(i.geometry.closed,!1),WHS.objects.forEach(function(e){"tube"==e.type&&a++}),s.type="tube",s.name=i.name||"tube"+a,s.visible=new this.threejs.Mesh(new this.threejs.TubeGeometry(i.geometry.path,i.geometry.segments,i.geometry.radius,i.geometry.radiusSegments,i.geometry.closed),s.materialType),s.visible.name=this.name,s.visible.position.set(i.pos.x,i.pos.y,i.pos.z),s.visible.rotation.set(Math.PI/180*i.rot.x,Math.PI/180*i.rot.y,Math.PI/180*i.rot.z),api.merge(this.scene,this.visible),t.onlyvis?s.onlyvis=!0:(s.physic=new WHS.API.TrimeshFigure(s.visible.geometry),s.body=new this.cannonjs.Body({mass:i.mass}),s.body.linearDamping=.9,s.body.addShape(s.physic),s.body.position.set(i.pos.x,i.pos.y,i.pos.z),s.body.quaternion.copy(s.visible.quaternion),s.body.name=s.name,api.merge(this.world,s.body)),WHS.objects.push(s)}return s},WHS.init.prototype.addGround=function(e,t,s,i){"use strict";var a={},r=0;switch(WHS.grounds.forEach(function(t){t.type==e&&r++}),a.type=e,a.name="ground"+r,api.def(t,{width:100,height:100}),s.type){case"basic":a.materialType=new this.threejs.MeshBasicMaterial(s);break;case"linebasic":a.materialType=new this.threejs.LineBasicMaterial(s);break;case"linedashed":a.materialType=new this.threejs.LineDashedMaterial(s);break;case"material":a.materialType=new this.threejs.Material(s);break;case"depth":a.materialType=new this.threejs.MeshDepthMaterial(s);break;case"face":a.materialType=new this.threejs.MeshFaceMaterial(s);break;case"lambert":a.materialType=new this.threejs.MeshLambertMaterial(s);break;case"normal":a.materialType=new this.threejs.MeshNormalMaterial(s);break;case"phong":a.materialType=new this.threejs.MeshPhongMaterial(s);break;case"pointcloud":a.materialType=new this.threejs.PointCloudMaterial(s);break;case"rawshader":a.materialType=new this.threejs.RawShaderMaterial(s);break;case"shader":scopescopematerialType=new this.threejs.ShaderMaterial(s);break;case"spritecanvas":scopescopematerialType=new this.threejs.SpriteCanvasMaterial(s);break;case"sprite":scopescopematerialType=new this.threejs.SpriteMaterial(s)}switch(e){case"smooth":a.visible=new this.threejs.Mesh(new this.threejs.PlaneBufferGeometry(t.width,t.height,1,1),a.materialType),a.visible.rotation.set(-0.5*Math.PI,0,0),a.visible.position.set(i.x,i.y,i.z),a.physic=new this.cannonjs.Plane(t.width,t.height),a.body=new this.cannonjs.Body({mass:0}),a.body.linearDamping=.9,a.body.addShape(a.physic),a.body.position.set(i.x,i.y,i.z),a.body.quaternion.setFromAxisAngle(new this.cannonjs.Vec3(1,0,0),-Math.PI/2),a.body.name=a.name,api.merge(this.world,a.body),api.merge(this.scene,a.visible);break;case"infinitySmooth":a.visible=new this.threejs.Mesh(new this.threejs.PlaneBufferGeometry(t.width,t.height,1,1),a.materialType),a.visible.rotation.set(-0.5*Math.PI,0,0),a.visible.position.set(i.x,i.y,i.z),a.physic=new this.cannonjs.Plane(t.width,t.height),a.body=new this.cannonjs.Body({mass:0}),a.body.linearDamping=.9,a.body.addShape(a.physic),a.body.position.set(posscopex,i.y,i.z),a.body.quaternion.setFromAxisAngle(new this.cannonjs.Vec3(1,0,0),-Math.PI/2),a.body.name=a.name,api.merge(this.world,a.body),api.merge(this.scene,a.visible);break;case"terrain":var o=t.detalityX||10,n=t.detalityY||10;a.detalityX=o,a.detalityY=n;var h=document.createElement("canvas");if(h.setAttribute("width",t.width),h.setAttribute("height",t.height),h.getContext){var m=h.getContext("2d");m.drawImage(t.terrain,0,0)}var p=TERRAINGEN.GetFromCanvas({alea:RAND_MT,generator:PN_GENERATOR,width:t.width,height:t.height,widthSegments:t.width,heightSegments:t.height,depth:t.depth,param:3,filterparam:1,filter:[BLUR_FILTER],postgen:[],effect:[DEPTHNOISE_EFFECT]},h,0,0,t.width,t.height);a.custumGeom=(new this.threejs.Geometry).fromBufferGeometry(p),a.custumGeom.verticesNeedUpdate=!0,a.custumGeom.elementsNeedUpdate=!0,a.custumGeom.normalsNeedUpdate=!0,a.custumGeom.computeFaceNormals(),a.custumGeom.computeVertexNormals(),a.visible=api.Triangulate(a.custumGeom,a.materialType),a.visible.scale.x=1,a.visible.scale.y=1,a.visible.position.set(i.x,i.y,i.z),a.physic=new WHS.API.TrimeshFigure((new this.threejs.Geometry).fromBufferGeometry(p)),a.body=new this.cannonjs.Body({mass:0}),a.body.linearDamping=.9,a.body.addShape(a.physic),a.body.position.set(i.x,i.y,i.z),a.physic.scale.x=1,a.physic.scale.y=1,a.body.name=a.name,api.merge(this.world,a.body),api.merge(this.scene,a.visible),a.visible.castShadow=!0,a.visible.receiveShadow=!0}return WHS.grounds.push(a),a},WHS.init.prototype.addLight=function(e,t,s,i){var a={};a.whsobject=!0,a.target=i,a.pos=s,console.log(a.pos);var r=api.def(t,{});switch(api.def(t.color,16777215,r.color),api.def(t.skyColor,16777215,r.skyColor),api.def(t.groundColor,16777215,r.groundColor),api.def(t.intensity,1,r.intensity),api.def(t.distance,100,r.distance),api.def(t.angle,Math.PI/3,r.angle),e){case"ambient":a.light=new this.threejs.AmbientLight(r.color);break;case"area":a.light=new this.threejs.AreaLight(r.color,r.intensity),console.warn([this.light],"This light only works in the deferredrenderer");break;case"directional":a.light=new this.threejs.DirectionalLight(r.color,r.intensity),a.light.castShadow=!0,a.light.shadowDarkness=.5;break;case"hemisphere":a.light=new this.threejs.HemisphereLight(r.skyColor,r.groundColor,r.intensity);break;case"light":a.light=new this.threejs.Light(r.color);break;case"point":a.light=new this.threejs.PointLight(r.color,r.intensity,r.distance);break;case"spot":a.light=new this.threejs.SpotLight(r.color,r.intensity,r.distance,r.angle),a.light.castShadow=!0,a.light.shadowMapWidth=1024,a.light.shadowMapHeight=1024,a.light.shadowCameraNear=50,a.light.shadowCameraFar=4e3,a.light.shadowCameraFov=30}return a.light.position.set(a.pos.x,a.pos.y,a.pos.z),a.light.target&&a.light.target.position.set(a.target.x,a.target.y,a.target.z),WHS.API.merge(this.scene,a.light),a},WHS.init.prototype.addFog=function(e,t){"use strict";var s={};switch(api.def(t.hex,0),api.def(t.near,.015),api.def(t.far,1e3),api.def(t.density,25e-5),e){case"fog":this.scene.fog=new this.threejs.Fog(t.hex,t.near,t.far);break;case"fogexp2":this.scene.fog=new this.threejs.FogExp2(t.hex,t.density)}return s},WHS.init.prototype.addWagner=function(e,t){"use strict";var s={};switch(t){case"zoomBlurPass":s.effect=new e.ZoomBlurPass,s.effect.params.strength=.05,s.effect.params.center.set(.5*this.composer.width,.5*this.composer.height),this.composer.pass(s.effect);break;case"multiPassBloomPass":s.effect=new e.MultiPassBloomPass,s.effect.params.blurAmount=1.32,s.effect.params.strength=.5,s.effect.params.applyZoomBlur=!0,s.effect.params.zoomBlurStrength=.84,s.effect.params.useTexture=!0,s.effect.glowTexture=e.Pass.prototype.getOfflineTexture(this.composer.width,this.composer.height,!1),s.effect.params.center.set(.5*this.composer.width,.5*this.composer.height),this.composer.pass(s.effect);break;case"vignettePass":s.effect=new e.VignettePass,s.effect.params.amount=.7,s.effect.params.falloff=.2,this.composer.pass(s.effect);break;case"directionalBlurPass":s.effect=new e.DirectionalBlurPass,s.effect.params.delta=.1,this.composer.pass(s.effect);break;case"motionBlurPass":s.motionBlurEffect=new e.DirectionalBlurPass,s.motionBlurEnable=!0,s.motionBlurEffect.params.delta=0,s.effect=s.motionBlurEffect,this.composer.pass(s.effect)}return this.composer.toScreen(),s.composer=this.composer,s.apply=function(){return this.composer.eff.push(s.effect),s},s},WHS.init.prototype.animate=function(e,t){"use strict";
function s(){t.stats&&t.stats.begin(),requestAnimationFrame(s),t.params.helper&&t.cannonDebugRenderer.update();for(var e=0;e<Object.keys(WHS.objects).length;e++)WHS.objects[e].onlyvis||(WHS.objects[e].visible.position.copy(WHS.objects[e].body.position),WHS.objects[e].visible.quaternion.copy(WHS.objects[e].body.quaternion));t.world.step(1/60),t.anaglyph&&t.effect.render(t.scene,t.camera),t.controls&&(t.controls.update(Date.now()-t.time),t.time=Date.now()),t.motionBlurEffect&&t.motionBlurEnable&&(t.motionBlurEffect.params.delta=0,t.motionBlurEnable=!0),t.composer&&(t.composer.reset(),t.composer.render(t.scene,t.camera),t.composer.eff.forEach(function(e){t.composer.pass(e)}),t.composer.toScreen()),t.stats&&t.stats.end()}this.update=s,this.update()},WHS.init.prototype.MakeFirstPerson=function(e,t,s){"use strict";console.log(this),this.controls=new t(this.camera,e.body,10,this);var i=this.controls;if(WHS.API.merge(this.scene,this.controls.getObject()),$("body").append('<div id="blocker">   <center>      <h1>PointerLock</h1>   </center>   <br>   <p>(W,A,S,D = Move, SPACE = Jump, MOUSE = Look)</p></div>'),$(s).css({color:"white",background:"rgba(0,0,0,0.5)","text-align":"center",position:"absolute",width:"100%",height:"100%",left:0,top:0}),"pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document){var a=document.body;this.pointerlockchange=function(){document.pointerLockElement===a||document.mozPointerLockElement===a||document.webkitPointerLockElement===a?(i.enabled=!0,$(s).css({display:"none"})):(i.enabled=!1,$(s).css({display:"block"}))}}document.addEventListener("pointerlockchange",this.pointerlockchange,!1),document.addEventListener("mozpointerlockchange",this.pointerlockchange,!1),document.addEventListener("webkitpointerlockchange",this.pointerlockchange,!1),this.pointerlockerror=function(){console.warn("Pointer lock error.")},document.addEventListener("pointerlockerror",this.pointerlockerror,!1),document.addEventListener("mozpointerlockerror",this.pointerlockerror,!1),document.addEventListener("webkitpointerlockerror",this.pointerlockerror,!1),$(s).on("click",function(){if(a.requestPointerLock=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock,/Firefox/i.test(navigator.userAgent)){var e=function(){(document.fullscreenElement===a||document.mozFullscreenElement===a||document.mozFullScreenElement===a)&&(document.removeEventListener("fullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),a.requestPointerLock())};document.addEventListener("fullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),a.requestFullscreen=a.requestFullscreen||a.mozRequestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen,a.requestFullscreen()}else a.requestPointerLock()})},WHS.init.prototype.OrbitControls=function(){this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement)};
